# Supabase Setup Guide

This project relies on Supabase for authentication, storage, and the dynamic gallery/shop data. Follow the steps below to collect the required credentials and provision the database objects the app expects.

## 1. Create a Supabase project
1. Go to [supabase.com](https://supabase.com) and sign in (create a free account if you do not have one yet).
2. Click **New project**, choose a name/region, and set a strong database password.
3. After the project finishes provisioning, open **Project Settings → API**. Copy the following values:
   - **Project URL** → `VITE_SUPABASE_URL`
   - **anon public** API key → `VITE_SUPABASE_ANON`

Store these values in your local `.env` file as described in [Environment variables](#4-configure-environment-variables).

## 2. Configure authentication
1. In the Supabase dashboard, open **Authentication → Providers** and ensure **Email** sign-in is enabled. (OAuth is optional.)
2. Go to **Authentication → Users**, click **Invite user**, and send an invite to the email you want to act as the admin (this must match `VITE_ADMIN_EMAIL`).
3. Complete the invitation flow from the inbox so the account has a password it can use with the in-app sign-in form.

## 3. Set up storage
1. Navigate to **Storage → Buckets** and create a new bucket named `drops-public` (or any name you prefer—just keep the same value in `VITE_SUPABASE_BUCKET`).
2. Mark the bucket as **Public** so visitors can view gallery/shop assets.
3. Under the bucket's **Policies** tab, add a policy that allows the `authenticated` role to `insert` and `update` objects. Example SQL:
   ```sql
   create policy "Authenticated uploads" on storage.objects
     for insert to authenticated
     with check (bucket_id = 'drops-public');
   ```

## 4. Provision database tables
Run the following SQL in the Supabase **SQL Editor** (update the admin email in the policy sections):

```sql
-- Gallery drops
create table if not exists public.drops (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default now(),
  title text not null,
  "group" text not null,
  tags text[] default '{}',
  src text not null,
  filename text,
  date date,
  "tiktokUrl" text
);

alter table public.drops enable row level security;

create policy if not exists "Public read drops" on public.drops
  for select using (true);

create policy if not exists "Admin insert drops" on public.drops
  for insert to authenticated
  with check (auth.email() = 'admin@example.com');

-- Shop catalog
create table if not exists public.shop_items (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default now(),
  name text not null,
  blurb text,
  description text,
  price text,
  download_url text,
  external_url text,
  highlights text[] default '{}',
  accent text,
  delivery text default 'download',
  cta_label text,
  category text
);

alter table public.shop_items enable row level security;

create policy if not exists "Public read shop" on public.shop_items
  for select using (true);

create policy if not exists "Admin insert shop" on public.shop_items
  for insert to authenticated
  with check (auth.email() = 'admin@example.com');
```

Replace `admin@example.com` with the same email you configured in step 2. Feel free to add additional `update`/`delete` policies if you need those capabilities.

## 5. Configure environment variables
1. Copy the example file to your local environment:
   ```bash
   cp .env.example .env.local
   ```
2. Fill in the values you collected:
   ```dotenv
   VITE_SUPABASE_URL=https://your-project.supabase.co
   VITE_SUPABASE_ANON=your-anon-key
   VITE_SUPABASE_BUCKET=drops-public
   VITE_ADMIN_EMAIL=admin@example.com
   # Optional: mirror the admin email if you want legacy configs to work
   VITE_ALLOWED_EMAIL=admin@example.com
   ```
3. Restart the dev server (`npm run dev`) so Vite picks up the new variables.

After these steps the in-app login/signup, admin uploader, and shop inventory will work against your own Supabase backend.
